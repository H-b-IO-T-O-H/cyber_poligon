version: "3.6"

services:
  proxy:
    image: nginx:stable
    #command: tail -f >> /dev/null
    container_name: proxy
#    ports:
#      - "8080:80" # внешний <- внутренний
    restart: unless-stopped
    networks:
      exported_net:
        ipv4_address: 10.10.0.2
       # private
      net_1:
      net_2:

  cont_1:
    build: ../userdata/1/
    container_name: container_1
    networks:
      - net_1

  cont_2:
    build: ../userdata/2/
    container_name: container_2
    networks:
      - net_2

networks:
  exported_net:
    name: exported_net
    driver: bridge
    ipam:
      config:
        - subnet: 10.10.0.0/30
          gateway: 10.10.0.1
   #приватные сети, которые создаются на каждый контейнер в userdata
  net_1:
    name: my_private_network_1
    driver: bridge
    ipam:
      config:
        - subnet: 10.10.10.0/24
          gateway: 10.10.10.1
  net_2:
    name: my_private_network_2
    driver: bridge
    ipam:
      config:
        - subnet: 10.10.11.0/24
          gateway: 10.10.11.1

